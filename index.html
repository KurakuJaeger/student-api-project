<!DOCTYPE html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST API Tester Dashboard</title>
    <!-- Tailwind CSS: Used for utility-first styling without writing separate CSS files -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the API method badges (GET, POST, etc.) */
        .method-badge { font-size: 10px; font-weight: bold; padding: 2px 8px; border-radius: 4px; margin-right: 8px; text-transform: uppercase; }
        .get-bg { background-color: #61affe; color: white; }
        .post-bg { background-color: #49cc90; color: white; }
        .put-bg { background-color: #fca130; color: white; }
        .delete-bg { background-color: #f93e3e; color: white; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans text-slate-900">

    <div class="max-w-5xl mx-auto p-6">
        <!-- Page Header: Describes the purpose of the application -->
        <header class="mb-8 border-b border-slate-300 pb-6">
            <h1 class="text-3xl font-extrabold text-slate-800">API Method Tester</h1>
            <p class="text-slate-600">Testing the Student Registry Server with modern JS patterns.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Left Column: Contains forms to send data to the server (CREATE, UPDATE, DELETE) -->
            <div class="space-y-6">
                
                <!-- CREATE (POST): Form to add a new student record -->
                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-green-500">
                    <div class="flex items-center mb-4">
                        <span class="method-badge post-bg">POST</span>
                        <h2 class="font-bold text-lg">Create Student</h2>
                    </div>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <input id="postName" type="text" placeholder="Name" class="p-2 border rounded text-sm">
                        <input id="postCourse" type="text" placeholder="Course" class="p-2 border rounded text-sm">
                    </div>
                    <button onclick="handlePost()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded font-semibold transition">Execute POST</button>
                </section>

                <!-- UPDATE (PUT): Form to modify an existing record based on its unique ID -->
                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-orange-400">
                    <div class="flex items-center mb-4">
                        <span class="method-badge put-bg">PUT</span>
                        <h2 class="font-bold text-lg">Update Student</h2>
                    </div>
                    <div class="grid grid-cols-1 gap-3 mb-3">
                        <input id="putId" type="number" placeholder="Student ID to Update" class="p-2 border rounded text-sm bg-slate-50">
                        <div class="grid grid-cols-2 gap-3">
                            <input id="putName" type="text" placeholder="New Name" class="p-2 border rounded text-sm">
                            <input id="putCourse" type="text" placeholder="New Course" class="p-2 border rounded text-sm">
                        </div>
                    </div>
                    <button onclick="handlePut()" class="w-full bg-orange-400 hover:bg-orange-500 text-white py-2 rounded font-semibold transition">Execute PUT</button>
                </section>

                <!-- DELETE: Form to remove a record from the database using its ID -->
                <section class="bg-white p-5 rounded-lg shadow-sm border-l-4 border-red-500">
                    <div class="flex items-center mb-4">
                        <span class="method-badge delete-bg">DELETE</span>
                        <h2 class="font-bold text-lg">Remove Student</h2>
                    </div>
                    <input id="deleteId" type="number" placeholder="Enter Student ID" class="w-full p-2 border rounded text-sm mb-3 bg-slate-50">
                    <button onclick="handleDelete()" class="w-full bg-red-500 hover:bg-red-600 text-white py-2 rounded font-semibold transition">Execute DELETE</button>
                </section>

            </div>

            <!-- Right Column: Displays the current data retrieved from the server -->
            <div class="space-y-6">
                
                <!-- READ (GET): Lists all students currently stored in the server memory -->
                <section class="bg-white p-5 rounded-lg shadow-sm border-t-4 border-blue-500 h-full flex flex-col">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <span class="method-badge get-bg">GET</span>
                            <h2 class="font-bold text-lg">Server State</h2>
                        </div>
                        <button onclick="fetchData()" class="text-blue-500 text-sm hover:underline">Refresh View</button>
                    </div>
                    
                    <!-- Notification area for success/error messages -->
                    <div id="statusLog" class="mb-4 text-xs font-mono p-2 bg-slate-900 text-green-400 rounded hidden"></div>

                    <!-- Container where student data will be dynamically injected by JavaScript -->
                    <div id="studentDisplay" class="flex-1 space-y-2 overflow-y-auto max-h-[500px]">
                        <!-- Student list items are generated here -->
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script>
        // The URL where your Express server is running
        const API_URL = 'http://localhost:3000/api/students';

        // Helper: Displays a brief message in the dark console box to show what happened
        function logAction(msg) {
            const log = document.getElementById('statusLog');
            log.innerText = `> ${msg}`;
            log.classList.remove('hidden');
            setTimeout(() => log.classList.add('hidden'), 3000); // Hide after 3 seconds
        }

        // GET: Requests the student list from the server and updates the HTML view
        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                // Use Optional Chaining (?.) to prevent errors if data is missing
                const students = data?.map(s => s) ?? [];
                
                const container = document.getElementById('studentDisplay');
                container.innerHTML = ''; // Clear the list before re-populating

                // Loop through each student and create their UI element
                students.forEach(s => {
                    const el = document.createElement('div');
                    el.className = "flex justify-between items-center p-3 bg-slate-50 border border-slate-200 rounded hover:border-blue-300 transition";
                    el.innerHTML = `
                        <div>
                            <span class="text-[10px] text-slate-400 font-mono">ID: ${s?.id ?? 'N/A'}</span>
                            <div class="font-bold text-slate-700">${s?.name ?? 'Unknown'}</div>
                        </div>
                        <div class="text-xs px-2 py-1 bg-slate-200 rounded text-slate-600 font-medium">
                            ${s?.course ?? 'Unassigned'}
                        </div>
                    `;
                    container.appendChild(el);
                });
                logAction("GET Successful: Syncing with server state.");
            } catch (e) {
                console.error(e);
                document.getElementById('studentDisplay').innerHTML = `<p class="text-red-500 text-sm italic">Failed to connect to server. Ensure server.js is running.</p>`;
            }
        }

        // POST: Sends new student data to the server to create a record
        async function handlePost() {
            const name = document.getElementById('postName').value;
            const course = document.getElementById('postCourse').value;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, course })
                });
                const result = await res.json();
                logAction(`POST Successful: Created Student #${result?.id}`);
                fetchData(); // Refresh the list to show the new student
            } catch (e) { logAction("POST Error"); }
        }

        // PUT: Sends updated data to the server for a specific student ID
        async function handlePut() {
            const id = document.getElementById('putId').value;
            const name = document.getElementById('putName').value;
            const course = document.getElementById('putCourse').value;

            if (!id) return logAction("Error: Missing ID for PUT");

            try {
                const res = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    // If an input is empty, we send 'undefined' so the server keeps the old value
                    body: JSON.stringify({ name: name || undefined, course: course || undefined })
                });
                
                if (res.status === 404) return logAction("Error: Student not found (404)");
                
                logAction(`PUT Successful: Updated Student #${id}`);
                fetchData(); // Refresh the list to show updates
            } catch (e) { logAction("PUT Error"); }
        }

        // DELETE: Tells the server to remove a student based on their ID
        async function handleDelete() {
            const id = document.getElementById('deleteId').value;
            if (!id) return logAction("Error: Missing ID for DELETE");

            try {
                const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                if (res.status === 404) return logAction("Error: Student not found (404)");

                logAction(`DELETE Successful: Removed Student #${id}`);
                fetchData(); // Refresh the list to remove the deleted student
            } catch (e) { logAction("DELETE Error"); }
        }

        // Automatically fetch data when the page first loads
        window.onload = fetchData;
    </script>
</body>
</html>
</html>
